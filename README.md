# Intelligent-Placer
## Постановка задачи
### Формат ввода многоугольника
Многоугольник, в котором необходимо разместить предметы, задаётся в формате:
```
(<x_1>, <y_1>), (<x_2>, <y_2>), ... , (<x_n>, <y_n>)
```
Где ```x_i y_i``` - координаты i-ой вершины.\
Координаты могут быть записаны как в одной, так и в нескольких строчках. Например:
```
(<x_1>, <y_1>),
(<x_2>, <y_2>),
 ...
(<x_n>, <y_n>)
```
В качестве единиц измерения используются сантиметры.

### Требования к входным данным

**Фотометрические** 
+ Минимальное разрешение фотографии: ```1280x720``` пикселей.
+ Расстояние от камеры до поверхности: ```30-40``` см.
+ Размытие объектов не должно превышать ```3-5``` пикселей.
+ Объекты не должны содержать на себе блики от источников света.
+ Освещение при съёмке должно быть схожим с освещением на фотографиях предметов. 
+ Угол наклона камеры не должен быть больше ```10``` градусов относительно перпендикуляра к поверхности.

**Расположение предметов**
+ Все объекты должны быть расположены на расстоянии ```1.5-2``` см друг от друга.
+ Предметы в кадре могут быть повёрнуты лишь относительно оси, перпендикулярной к поверхности, остальные изменения положения и ракурса не разрешаются.
+ Не должно присутствовать объектов лишь частично расположенных в кадре.

**Кол-во предметов**
+ Суммарное кол-во предметов не должно превышать ```15```.
+ Один и тот же объект может встречаться несколько раз.

## План решения
### Распознавание объектов

Реализовать алгоритм распознавания заданного набора объектов при помощи Feature matching.
   + Выделить контуры объектов при помощи оператора Canny на входном изображении и на всех изображениях предметов.
   + Заполнить полученные контуры и вырезать отдельно каждый предмет:
   + Найти на всех предметах ключевые точки, используя алгоритм [SIFT](https://docs.opencv.org/4.x/da/df5/tutorial_py_sift_intro.html). 
   + Попарно искать совпадения на предметах из заданного набора и предметах, полученных из входного изображения, при помощи [FlannBasedMatcher](https://docs.opencv.org/3.4/d5/d6f/tutorial_feature_flann_matcher.html).
   + Фильтровать совпадения при помощи сравнения расстояния между двумя ближайшими соседями ([Lowe test](https://link.springer.com/article/10.1023/B:VISI.0000029664.99615.94)).
   + Соотнести каждый предмет на входном изображении с тем предметом из заданного набора, для которого отношение "хороших совпадений" к общему числу ключевых точек будет наибольшим.
   + В случае, если данное отношение ниже некоторого порогового значения, считать что предмет не принадлежит заданному набору.

Возможные улучшения:
+ Использовать более сложный способ фильтрации совпадений.\
  К примеру, использовать поиск гомографии или метод RANSAC.
+ Иначе вычислять оценку схожести двух предметов.
+ Использовать другое количество соседей при поиске совпадений (на данный момент = 2)

### Алгоритм укладки
1. Реализовать примитивный алгоритм по стратегии Bottom-Left.
    1. Отсортировать объекты по их размеру.
    2. Разместить объект над верхней левой границей многоугольника. 
    3. Пока смещение объекта возможно:
        + Сместить объект как можно ниже при условии отсутствия пересечений. 
        + Сместить объект как можно левее также при условии отсутствия пересечений. 
    4. В случае, подходящая позиция была найдена, взять следующий объект и вернуться к пункту (ii), иначе сместить начальную позицию вправо и вернуться к пункту (iii).
    5. Если начальная позиция сместилась за правую границу ограничивающего многоугольника, вернуть отрицательный результат.
    6. Если все объекты были размещены вернуть положительный результат.

2. Перейти к каноническому виду задач укладки, где решается задача оптимизации для прямоугольника, у которого одна размерность фиксирована, а другую необходимо минимизировать. \
Для перехода от многоугольника к прямоугольнику будем создавать фиктивные объекты, которые имеют фиксированную позицию.\
Таким образом, взяв прямоугольник по границам многоугольника, мы сможем обрезать его до нужной формы.
3. Реализовать эвристику NFP из [A 2-exchange heuristic for nesting problems](https://www.researchgate.net/publication/223569465_A_2-exchange_heuristic_for_nesting_problems). \
ИЛИ
4. Реализовать генетический алгоритм на подобие [A Parallel Biased Random-Key Genetic Algorithm with Multiple
Populations Applied to Irregular Strip Packing Problems](https://www.researchgate.net/publication/319874610_A_Parallel_Biased_Random-Key_Genetic_Algorithm_with_Multiple_Populations_Applied_to_Irregular_Strip_Packing_Problems)

Возможные улучшения:
   + Использовать бинарное дробление интервала вместо постоянного шага, как показано здесь [Two-dimensional packing for irregular shaped objects](https://www.researchgate.net/publication/224739203_Two-dimensional_packing_for_irregular_shaped_objects).
